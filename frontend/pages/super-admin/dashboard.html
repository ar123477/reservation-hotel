<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Admin - TogoHotel Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar {
            min-height: calc(100vh - 56px);
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
        }
        .sidebar .nav-link {
            color: #333;
            padding: 0.75rem 1rem;
            border-radius: 0.375rem;
            margin: 0.125rem 0.5rem;
        }
        .sidebar .nav-link.active {
            background-color: #0d6efd;
            color: white;
        }
        .sidebar .nav-link:hover:not(.active) {
            background-color: #f8f9fa;
        }
        .dashboard-card {
            transition: transform 0.2s;
        }
        .dashboard-card:hover {
            transform: translateY(-2px);
        }
        .table-actions {
            white-space: nowrap;
        }
        .badge-lg {
            font-size: 0.875em;
            padding: 0.5em 0.75em;
        }
        .progress {
            height: 8px;
        }
        .nav-tabs .nav-link.active {
            font-weight: 600;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="../../index.html">
                <i class="fas fa-hotel me-2"></i>TogoHotel Manager
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../../index.html">Accueil</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../hotels.html">Hôtels</a>
                    </li>
                </ul>
                <div class="navbar-nav" id="userMenu">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-crown me-1 text-warning"></i>
                            <span id="userName">Super Admin</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item active" href="#">
                                <i class="fas fa-crown me-2 text-warning"></i>Super Admin
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#" onclick="Auth.logout()">
                                <i class="fas fa-sign-out-alt me-2"></i>Déconnexion
                            </a></li>
                        </ul>
                    </li>
                </div>
            </div>
        </div>
    </nav>

    <!-- Contenu Principal -->
    <div class="container-fluid mt-5 pt-4">
        <div class="row">
            <!-- Sidebar -->
            <nav class="col-md-3 col-lg-2 d-md-block bg-light sidebar">
                <div class="position-sticky pt-3">
                    <h6 class="sidebar-heading px-3 mb-3 text-muted text-uppercase">
                        <i class="fas fa-crown me-1 text-warning"></i>Super Administration
                    </h6>
                    <ul class="nav flex-column mb-4">
                        <li class="nav-item">
                            <a class="nav-link active" href="#overview">
                                <i class="fas fa-tachometer-alt me-2"></i>
                                Vue d'Ensemble
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#hotels">
                                <i class="fas fa-hotel me-2"></i>
                                Gestion Hôtels
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#users">
                                <i class="fas fa-users me-2"></i>
                                Gestion Utilisateurs
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#reports">
                                <i class="fas fa-chart-bar me-2"></i>
                                Rapports Globaux
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#system">
                                <i class="fas fa-cogs me-2"></i>
                                Configuration Système
                            </a>
                        </li>
                    </ul>

                    <h6 class="sidebar-heading px-3 mb-3 text-muted text-uppercase">
                        <i class="fas fa-chart-line me-1"></i>Statistiques Rapides
                    </h6>
                    <div class="px-3">
                        <div class="d-flex justify-content-between mb-2">
                            <small>Hôtels Actifs:</small>
                            <strong id="sidebarHotels">4</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <small>Utilisateurs:</small>
                            <strong id="sidebarUsers">16</strong>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <small>CA Total:</small>
                            <strong id="sidebarRevenue">4.8M FCFA</strong>
                        </div>
                        <div class="d-flex justify-content-between">
                            <small>Occupation:</small>
                            <strong id="sidebarOccupancy">72%</strong>
                        </div>
                    </div>
                </div>
            </nav>

            <!-- Contenu -->
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <!-- En-tête -->
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">
                        <i class="fas fa-crown me-2 text-warning"></i>Super Administration
                    </h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <button class="btn btn-sm btn-outline-secondary" onclick="refreshData()">
                                <i class="fas fa-sync-alt me-1"></i>Actualiser
                            </button>
                            <button class="btn btn-sm btn-outline-primary" onclick="exportData()">
                                <i class="fas fa-download me-1"></i>Exporter
                            </button>
                        </div>
                        <button class="btn btn-sm btn-success" onclick="showCreateHotelModal()">
                            <i class="fas fa-plus me-1"></i>Nouvel Hôtel
                        </button>
                    </div>
                </div>

                <!-- KPIs Globaux -->
                <div class="row mb-4">
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card dashboard-card border-start border-primary border-4">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <div class="text-xs fw-bold text-primary text-uppercase mb-1">
                                            CA Total
                                        </div>
                                        <div class="h5 mb-0 fw-bold text-gray-800" id="totalRevenue">0 FCFA</div>
                                        <div class="mt-2 mb-0 text-xs">
                                            <span class="text-success me-2">
                                                <i class="fas fa-arrow-up me-1"></i>12.5%
                                            </span>
                                            <span class="text-muted">vs mois dernier</span>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-money-bill-wave fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card dashboard-card border-start border-success border-4">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <div class="text-xs fw-bold text-success text-uppercase mb-1">
                                            Hôtels Actifs
                                        </div>
                                        <div class="h5 mb-0 fw-bold text-gray-800" id="activeHotels">0</div>
                                        <div class="mt-2 mb-0 text-xs">
                                            <span class="text-success me-2">
                                                <i class="fas fa-hotel me-1"></i>
                                            </span>
                                            <span class="text-muted">sur 4 au total</span>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-hotel fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card dashboard-card border-start border-warning border-4">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <div class="text-xs fw-bold text-warning text-uppercase mb-1">
                                            Utilisateurs
                                        </div>
                                        <div class="h5 mb-0 fw-bold text-gray-800" id="totalUsers">0</div>
                                        <div class="mt-2 mb-0 text-xs">
                                            <span class="text-success me-2">
                                                <i class="fas fa-user-plus me-1"></i>3
                                            </span>
                                            <span class="text-muted">nouveaux ce mois</span>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-users fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-xl-3 col-md-6 mb-4">
                        <div class="card dashboard-card border-start border-info border-4">
                            <div class="card-body">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <div class="text-xs fw-bold text-info text-uppercase mb-1">
                                            Taux d'Occupation Moyen
                                        </div>
                                        <div class="h5 mb-0 fw-bold text-gray-800" id="avgOccupancy">0%</div>
                                        <div class="mt-2 mb-0 text-xs">
                                            <span class="text-success me-2">
                                                <i class="fas fa-chart-line me-1"></i>
                                            </span>
                                            <span class="text-muted">performance globale</span>
                                        </div>
                                    </div>
                                    <div class="col-auto">
                                        <i class="fas fa-percentage fa-2x text-gray-300"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vue d'Ensemble des Hôtels -->
                <div class="card mb-4" id="overview">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-bar me-2 text-primary"></i>Performance des Hôtels
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Hôtel</th>
                                        <th>Ville</th>
                                        <th>CA Total</th>
                                        <th>Réservations</th>
                                        <th>Taux d'Occupation</th>
                                        <th>Performance</th>
                                        <th>Statut</th>
                                    </tr>
                                </thead>
                                <tbody id="hotelsPerformance">
                                    <!-- Les données de performance seront chargées ici -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Gestion des Hôtels -->
                <div class="card mb-4" id="hotels">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-hotel me-2 text-warning"></i>Gestion des Hôtels
                        </h5>
                        <button class="btn btn-sm btn-success" onclick="showCreateHotelModal()">
                            <i class="fas fa-plus me-1"></i>Ajouter un Hôtel
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Nom</th>
                                        <th>Ville</th>
                                        <th>Contact</th>
                                        <th>Chambres</th>
                                        <th>Date Création</th>
                                        <th>Statut</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="hotelsList">
                                    <!-- La liste des hôtels sera chargée ici -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Gestion des Utilisateurs -->
                <div class="card mb-4" id="users">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-users me-2 text-info"></i>Gestion des Utilisateurs
                        </h5>
                        <button class="btn btn-sm btn-success" onclick="showCreateUserModal()">
                            <i class="fas fa-user-plus me-1"></i>Nouvel Utilisateur
                        </button>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Nom</th>
                                        <th>Email</th>
                                        <th>Rôle</th>
                                        <th>Hôtel</th>
                                        <th>Date Création</th>
                                        <th>Statut</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="usersList">
                                    <!-- La liste des utilisateurs sera chargée ici -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Rapports Globaux -->
                <div class="card" id="reports">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-line me-2 text-success"></i>Rapports et Statistiques
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <h6>Réservations par Mois</h6>
                                        <canvas id="bookingsChart" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="card mb-3">
                                    <div class="card-body">
                                        <h6>Répartition des Rôles</h6>
                                        <canvas id="rolesChart" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal Création Hôtel -->
    <div class="modal fade" id="createHotelModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Créer un Nouvel Hôtel</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createHotelForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="hotelName" class="form-label">Nom de l'hôtel *</label>
                                <input type="text" class="form-control" id="hotelName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="hotelCity" class="form-label">Ville *</label>
                                <input type="text" class="form-control" id="hotelCity" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="hotelAddress" class="form-label">Adresse</label>
                            <textarea class="form-control" id="hotelAddress" rows="2"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="hotelPhone" class="form-label">Téléphone</label>
                                <input type="tel" class="form-control" id="hotelPhone">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="hotelEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="hotelEmail">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="hotelDescription" class="form-label">Description</label>
                            <textarea class="form-control" id="hotelDescription" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-success" id="confirmCreateHotel">Créer l'Hôtel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Création Utilisateur -->
    <div class="modal fade" id="createUserModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Créer un Nouvel Utilisateur</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="createUserForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="userPrenom" class="form-label">Prénom *</label>
                                <input type="text" class="form-control" id="userPrenom" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userNom" class="form-label">Nom *</label>
                                <input type="text" class="form-control" id="userNom" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="userEmail" class="form-label">Email *</label>
                            <input type="email" class="form-control" id="userEmail" required>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="userRole" class="form-label">Rôle *</label>
                                <select class="form-select" id="userRole" required>
                                    <option value="">Sélectionner un rôle...</option>
                                    <option value="client">Client</option>
                                    <option value="reception">Réception</option>
                                    <option value="menage">Ménage</option>
                                    <option value="admin_hotel">Admin Hôtel</option>
                                    <option value="super_admin">Super Admin</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userHotel" class="form-label">Hôtel Assigné</label>
                                <select class="form-select" id="userHotel">
                                    <option value="">Aucun hôtel</option>
                                    <!-- Les hôtels seront chargés dynamiquement -->
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="userPhone" class="form-label">Téléphone</label>
                            <input type="tel" class="form-control" id="userPhone">
                        </div>
                        <div class="mb-3">
                            <label for="userPassword" class="form-label">Mot de passe *</label>
                            <input type="password" class="form-control" id="userPassword" required minlength="6">
                            <div class="form-text">Le mot de passe doit contenir au moins 6 caractères.</div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="button" class="btn btn-success" id="confirmCreateUser">Créer l'Utilisateur</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../../js/auth.js"></script>
    <script src="../../js/api.js"></script>
    <script>
        // Classes utilitaires
        class Utils {
            static formatPrice(price) {
                return new Intl.NumberFormat('fr-FR', { 
                    style: 'currency', 
                    currency: 'XOF' 
                }).format(price);
            }

            static formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('fr-FR', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });
            }

            static formatPhoneNumber(phone) {
                return phone.replace(/(\d{3})(\d{2})(\d{2})(\d{2})/, '$1 $2 $3 $4');
            }

            static showSuccess(message) {
                // Créer une alerte temporaire
                const alert = document.createElement('div');
                alert.className = 'alert alert-success alert-dismissible fade show position-fixed top-0 end-0 m-3';
                alert.style.zIndex = '9999';
                alert.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                document.body.appendChild(alert);
                
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, 3000);
            }

            static showError(container, message) {
                container.innerHTML = `
                    <tr>
                        <td colspan="7" class="text-center text-danger py-4">
                            <i class="fas fa-exclamation-triangle me-2"></i>${message}
                        </td>
                    </tr>
                `;
            }
        }

        // Variables globales
        let bookingsChart = null;
        let rolesChart = null;
        let allHotels = [];
        let allUsers = [];

        // Fonctions utilitaires pour les rôles
        function getRoleText(role) {
            const roles = {
                'super_admin': 'Super Admin',
                'admin_hotel': 'Admin Hôtel',
                'reception': 'Réception',
                'menage': 'Ménage',
                'client': 'Client'
            };
            return roles[role] || role;
        }

        function getRoleBadgeClass(role) {
            const classes = {
                'super_admin': 'bg-warning',
                'admin_hotel': 'bg-success',
                'reception': 'bg-info',
                'menage': 'bg-secondary',
                'client': 'bg-primary'
            };
            return classes[role] || 'bg-secondary';
        }

        function getUserHotelName(hotelId) {
            const hotel = allHotels.find(h => h.id === hotelId);
            return hotel ? hotel.nom : null;
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            if (!Auth.requireRole(['super_admin'])) return;
            Auth.updateNavigation();
            loadDashboardData();
            setupEventListeners();
        });

        // Configuration des écouteurs d'événements
        function setupEventListeners() {
            // Navigation smooth scroll
            document.querySelectorAll('.sidebar .nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const target = this.getAttribute('href');
                    if (target.startsWith('#')) {
                        document.querySelector(target).scrollIntoView({
                            behavior: 'smooth'
                        });
                    }
                });
            });

            // Confirmer création hôtel
            document.getElementById('confirmCreateHotel').addEventListener('click', createHotel);

            // Confirmer création utilisateur
            document.getElementById('confirmCreateUser').addEventListener('click', createUser);
        }

        // Charger les données du dashboard
        async function loadDashboardData() {
            try {
                await Promise.all([
                    loadHotels(),
                    loadUsers(),
                    loadKPIs(),
                    loadCharts()
                ]);
                updateSidebarStats();
            } catch (error) {
                console.error('Erreur lors du chargement du dashboard:', error);
            }
        }

        // Actualiser les données
        async function refreshData() {
            const refreshBtn = document.querySelector('button[onclick="refreshData()"]');
            const originalHtml = refreshBtn.innerHTML;
            
            refreshBtn.disabled = true;
            refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Actualisation...';

            try {
                await loadDashboardData();
                Utils.showSuccess('Données actualisées avec succès !');
            } catch (error) {
                console.error('Erreur lors de l\'actualisation:', error);
                Utils.showSuccess('Erreur lors de l\'actualisation des données.');
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.innerHTML = originalHtml;
            }
        }

        // Exporter les données
        function exportData() {
            Utils.showSuccess('Export des données en cours...');
            // Simulation d'export
            setTimeout(() => {
                Utils.showSuccess('Données exportées avec succès !');
            }, 2000);
        }

        // Mettre à jour les statistiques de la sidebar
        function updateSidebarStats() {
            document.getElementById('sidebarHotels').textContent = allHotels.length;
            document.getElementById('sidebarUsers').textContent = allUsers.length;
            document.getElementById('sidebarRevenue').textContent = '4.8M FCFA';
            document.getElementById('sidebarOccupancy').textContent = '72%';
        }

        // Charger les KPIs
        async function loadKPIs() {
            try {
                // Données simulées pour la démonstration
                const totalRevenue = 4850000;
                const activeHotels = allHotels.filter(h => h.statut === 'actif').length;
                const totalUsers = allUsers.length;
                const avgOccupancy = 72;

                document.getElementById('totalRevenue').textContent = Utils.formatPrice(totalRevenue);
                document.getElementById('activeHotels').textContent = activeHotels;
                document.getElementById('totalUsers').textContent = totalUsers;
                document.getElementById('avgOccupancy').textContent = avgOccupancy + '%';

            } catch (error) {
                console.error('Erreur lors du chargement des KPIs:', error);
            }
        }

        // Charger la liste des hôtels
        async function loadHotels() {
            try {
                const hotels = await API.getHotels();
                allHotels = hotels;
                displayHotelsList(hotels);
                displayHotelsPerformance(hotels);
            } catch (error) {
                console.error('Erreur lors du chargement des hôtels:', error);
                Utils.showError(document.getElementById('hotelsList'), 
                    'Impossible de charger la liste des hôtels.');
            }
        }

        // Afficher la liste des hôtels
        function displayHotelsList(hotels) {
            const container = document.getElementById('hotelsList');
            let html = '';

            if (hotels.length === 0) {
                html = `
                    <tr>
                        <td colspan="7" class="text-center text-muted py-4">
                            <i class="fas fa-hotel fa-2x mb-3"></i><br>
                            Aucun hôtel trouvé
                        </td>
                    </tr>
                `;
            } else {
                hotels.forEach(hotel => {
                    html += `
                        <tr>
                            <td>
                                <strong>${hotel.nom}</strong>
                                ${hotel.email ? `<br><small class="text-muted">${hotel.email}</small>` : ''}
                            </td>
                            <td>${hotel.ville}</td>
                            <td>
                                ${hotel.telephone ? `<small>${Utils.formatPhoneNumber(hotel.telephone)}</small>` : '-'}
                            </td>
                            <td>
                                <span class="badge bg-secondary">60 chambres</span>
                            </td>
                            <td>
                                <small>${Utils.formatDate(hotel.date_creation)}</small>
                            </td>
                            <td>
                                <span class="badge ${hotel.statut === 'actif' ? 'bg-success' : 'bg-secondary'}">
                                    ${hotel.statut === 'actif' ? 'Actif' : 'Inactif'}
                                </span>
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary" onclick="editHotel(${hotel.id})" title="Modifier">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-outline-info" onclick="viewHotelDetails(${hotel.id})" title="Détails">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-outline-warning" onclick="toggleHotelStatus(${hotel.id}, '${hotel.statut}')" title="Changer statut">
                                        <i class="fas fa-power-off"></i>
                                    </button>
                                    <button class="btn btn-outline-danger" onclick="deleteHotel(${hotel.id})" title="Supprimer">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
            }

            container.innerHTML = html;
        }

        // Afficher les performances des hôtels
        function displayHotelsPerformance(hotels) {
            const container = document.getElementById('hotelsPerformance');
            let html = '';

            hotels.forEach(hotel => {
                // Données simulées pour la démonstration
                const revenue = Math.floor(Math.random() * 2000000) + 500000;
                const bookings = Math.floor(Math.random() * 100) + 20;
                const occupancy = Math.floor(Math.random() * 40) + 50;
                const performance = occupancy > 70 ? 'Excelente' : occupancy > 50 ? 'Bonne' : 'Moyenne';

                html += `
                    <tr>
                        <td>
                            <strong>${hotel.nom}</strong>
                        </td>
                        <td>${hotel.ville}</td>
                        <td>
                            <span class="fw-bold text-primary">${Utils.formatPrice(revenue)}</span>
                        </td>
                        <td>${bookings}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="progress flex-grow-1 me-2">
                                    <div class="progress-bar ${occupancy > 70 ? 'bg-success' : occupancy > 50 ? 'bg-warning' : 'bg-danger'}" 
                                         style="width: ${occupancy}%"></div>
                                </div>
                                <span>${occupancy}%</span>
                            </div>
                        </td>
                        <td>
                            <span class="badge ${performance === 'Excelente' ? 'bg-success' : performance === 'Bonne' ? 'bg-warning' : 'bg-danger'}">
                                ${performance}
                            </span>
                        </td>
                        <td>
                            <span class="badge ${hotel.statut === 'actif' ? 'bg-success' : 'bg-secondary'}">
                                ${hotel.statut === 'actif' ? 'Actif' : 'Inactif'}
                            </span>
                        </td>
                    </tr>
                `;
            });

            container.innerHTML = html;
        }

        // Charger la liste des utilisateurs
        async function loadUsers() {
            try {
                // Pour l'instant, on utilise des données simulées
                // Dans une vraie application, vous auriez un endpoint API pour récupérer tous les utilisateurs
                const users = [
                    {
                        id: 1,
                        prenom: 'Super',
                        nom: 'Admin',
                        email: 'superadmin@system.tg',
                        role: 'super_admin',
                        hotel_id: null,
                        telephone: '+228 90 00 00 01',
                        date_creation: new Date().toISOString(),
                        statut: 'actif'
                    },
                    {
                        id: 2,
                        prenom: 'Admin',
                        nom: 'Sarakawa',
                        email: 'admin@sarakawa.tg',
                        role: 'admin_hotel',
                        hotel_id: 1,
                        telephone: '+228 90 00 00 02',
                        date_creation: new Date().toISOString(),
                        statut: 'actif'
                    },
                    {
                        id: 3,
                        prenom: 'Réception',
                        nom: 'Sarakawa',
                        email: 'reception@sarakawa.tg',
                        role: 'reception',
                        hotel_id: 1,
                        telephone: '+228 90 00 00 03',
                        date_creation: new Date().toISOString(),
                        statut: 'actif'
                    },
                    {
                        id: 14,
                        prenom: 'Test',
                        nom: 'Client',
                        email: 'client@togo.tg',
                        role: 'client',
                        hotel_id: null,
                        telephone: '+228 90 00 00 14',
                        date_creation: new Date().toISOString(),
                        statut: 'actif'
                    }
                ];

                allUsers = users;
                displayUsersList(users);

            } catch (error) {
                console.error('Erreur lors du chargement des utilisateurs:', error);
                Utils.showError(document.getElementById('usersList'), 
                    'Impossible de charger la liste des utilisateurs.');
            }
        }

        // Afficher la liste des utilisateurs
        function displayUsersList(users) {
            const container = document.getElementById('usersList');
            let html = '';

            if (users.length === 0) {
                html = `
                    <tr>
                        <td colspan="7" class="text-center text-muted py-4">
                            <i class="fas fa-users fa-2x mb-3"></i><br>
                            Aucun utilisateur trouvé
                        </td>
                    </tr>
                `;
            } else {
                users.forEach(user => {
                    const hotelName = getUserHotelName(user.hotel_id);
                    
                    html += `
                        <tr>
                            <td>
                                <strong>${user.prenom} ${user.nom}</strong>
                                <br><small class="text-muted">${user.email}</small>
                            </td>
                            <td>${user.email}</td>
                            <td>
                                <span class="badge ${getRoleBadgeClass(user.role)}">
                                    ${getRoleText(user.role)}
                                </span>
                            </td>
                            <td>${hotelName || '-'}</td>
                            <td>
                                <small>${Utils.formatDate(user.date_creation)}</small>
                            </td>
                            <td>
                                <span class="badge ${user.statut === 'actif' ? 'bg-success' : 'bg-secondary'}">
                                    ${user.statut === 'actif' ? 'Actif' : 'Inactif'}
                                </span>
                            </td>
                            <td>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-primary" onclick="editUser(${user.id})" title="Modifier">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-outline-warning" onclick="toggleUserStatus(${user.id}, '${user.statut}')" title="Changer statut">
                                        <i class="fas fa-power-off"></i>
                                    </button>
                                    <button class="btn btn-outline-danger" onclick="deleteUser(${user.id})" ${user.role === 'super_admin' ? 'disabled' : ''} title="Supprimer">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `;
                });
            }

            container.innerHTML = html;
        }

        // Charger les graphiques
        function loadCharts() {
            // Graphique des réservations
            const bookingsCtx = document.getElementById('bookingsChart').getContext('2d');
            if (bookingsChart) bookingsChart.destroy();
            
            bookingsChart = new Chart(bookingsCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Fév', 'Mar', 'Avr', 'Mai', 'Jun', 'Jul', 'Aoû', 'Sep', 'Oct', 'Nov', 'Déc'],
                    datasets: [{
                        label: 'Réservations',
                        data: [45, 52, 48, 55, 58, 62, 65, 70, 63, 68, 72, 75],
                        backgroundColor: '#0d6efd',
                        borderColor: '#0b5ed7',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value;
                                }
                            }
                        }
                    }
                }
            });

            // Graphique des rôles
            const rolesCtx = document.getElementById('rolesChart').getContext('2d');
            if (rolesChart) rolesChart.destroy();
            
            rolesChart = new Chart(rolesCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Clients', 'Réception', 'Ménage', 'Admins Hôtel', 'Super Admin'],
                    datasets: [{
                        data: [8, 2, 2, 3, 1],
                        backgroundColor: [
                            '#6c757d',
                            '#0dcaf0',
                            '#ffc107',
                            '#198754',
                            '#fd7e14'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // Afficher le modal de création d'hôtel
        function showCreateHotelModal() {
            const modal = new bootstrap.Modal(document.getElementById('createHotelModal'));
            document.getElementById('createHotelForm').reset();
            modal.show();
        }

        // Afficher le modal de création d'utilisateur
        function showCreateUserModal() {
            // Charger la liste des hôtels dans le select
            const hotelSelect = document.getElementById('userHotel');
            hotelSelect.innerHTML = '<option value="">Aucun hôtel</option>';
            
            allHotels.forEach(hotel => {
                hotelSelect.innerHTML += `<option value="${hotel.id}">${hotel.nom} - ${hotel.ville}</option>`;
            });

            const modal = new bootstrap.Modal(document.getElementById('createUserModal'));
            document.getElementById('createUserForm').reset();
            modal.show();
        }

        // Créer un nouvel hôtel
        async function createHotel() {
            const form = document.getElementById('createHotelForm');
            
            const hotelData = {
                nom: document.getElementById('hotelName').value,
                ville: document.getElementById('hotelCity').value,
                adresse: document.getElementById('hotelAddress').value,
                telephone: document.getElementById('hotelPhone').value,
                email: document.getElementById('hotelEmail').value,
                description: document.getElementById('hotelDescription').value
            };

            if (!hotelData.nom || !hotelData.ville) {
                alert('Veuillez remplir les champs obligatoires (Nom et Ville).');
                return;
            }

            const button = document.getElementById('confirmCreateHotel');
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Création...';

            try {
                // Simulation de création d'hôtel
                console.log('Création hôtel:', hotelData);
                
                // Dans une vraie application, vous utiliseriez:
                // await API.createHotel(hotelData);
                
                Utils.showSuccess('Hôtel créé avec succès !');
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('createHotelModal'));
                modal.hide();
                
                // Recharger la liste des hôtels
                setTimeout(() => {
                    loadHotels();
                }, 1000);

            } catch (error) {
                console.error('Erreur lors de la création:', error);
                alert(`Erreur lors de la création: ${error.message}`);
            } finally {
                button.disabled = false;
                button.innerHTML = 'Créer l\'Hôtel';
            }
        }

        // Créer un nouvel utilisateur
        async function createUser() {
            const form = document.getElementById('createUserForm');
            
            const userData = {
                prenom: document.getElementById('userPrenom').value,
                nom: document.getElementById('userNom').value,
                email: document.getElementById('userEmail').value,
                role: document.getElementById('userRole').value,
                hotel_id: document.getElementById('userHotel').value || null,
                telephone: document.getElementById('userPhone').value,
                password: document.getElementById('userPassword').value
            };

            if (!userData.prenom || !userData.nom || !userData.email || !userData.role || !userData.password) {
                alert('Veuillez remplir tous les champs obligatoires.');
                return;
            }

            const button = document.getElementById('confirmCreateUser');
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Création...';

            try {
                // Simulation de création d'utilisateur
                console.log('Création utilisateur:', userData);
                
                // Dans une vraie application, vous utiliseriez:
                // await API.createUser(userData);
                
                Utils.showSuccess('Utilisateur créé avec succès !');
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('createUserModal'));
                modal.hide();
                
                // Recharger la liste des utilisateurs
                setTimeout(() => {
                    loadUsers();
                }, 1000);

            } catch (error) {
                console.error('Erreur lors de la création:', error);
                alert(`Erreur lors de la création: ${error.message}`);
            } finally {
                button.disabled = false;
                button.innerHTML = 'Créer l\'Utilisateur';
            }
        }

        // Fonctions de gestion des hôtels
        function editHotel(hotelId) {
            Utils.showSuccess(`Modification de l'hôtel ${hotelId}`);
            // Implémentez la logique d'édition
        }

        function viewHotelDetails(hotelId) {
            window.location.href = `../hotel-detail.html?id=${hotelId}`;
        }

        function toggleHotelStatus(hotelId, currentStatus) {
            const newStatus = currentStatus === 'actif' ? 'inactif' : 'actif';
            if (confirm(`Voulez-vous vraiment ${newStatus === 'actif' ? 'activer' : 'désactiver'} cet hôtel ?`)) {
                // Implémentez la logique de changement de statut
                Utils.showSuccess(`Statut de l'hôtel changé à ${newStatus}`);
                loadHotels();
            }
        }

        function deleteHotel(hotelId) {
            if (confirm('Voulez-vous vraiment supprimer cet hôtel ? Cette action est irréversible.')) {
                // Implémentez la logique de suppression
                Utils.showSuccess('Hôtel supprimé avec succès');
                loadHotels();
            }
        }

        // Fonctions de gestion des utilisateurs
        function editUser(userId) {
            Utils.showSuccess(`Modification de l'utilisateur ${userId}`);
            // Implémentez la logique d'édition
        }

        function toggleUserStatus(userId, currentStatus) {
            const newStatus = currentStatus === 'actif' ? 'inactif' : 'actif';
            if (confirm(`Voulez-vous vraiment ${newStatus === 'actif' ? 'activer' : 'désactiver'} cet utilisateur ?`)) {
                // Implémentez la logique de changement de statut
                Utils.showSuccess(`Statut de l'utilisateur changé à ${newStatus}`);
                loadUsers();
            }
        }

        function deleteUser(userId) {
            if (confirm('Voulez-vous vraiment supprimer cet utilisateur ? Cette action est irréversible.')) {
                // Implémentez la logique de suppression
                Utils.showSuccess('Utilisateur supprimé avec succès');
                loadUsers();
            }
        }
    </script>
</body>
</html>