<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Détail de l'Hôtel - TogoHotel Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../css/style.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <i class="fas fa-hotel me-2"></i>TogoHotel Manager
            </a>
            <div class="collapse navbar-collapse">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="../index.html">Accueil</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="hotels.html">Hôtels</a>
                    </li>
                </ul>
                <div class="navbar-nav" id="authLinks">
                    <a class="nav-link" href="login.html">Connexion</a>
                    <a class="nav-link" href="signup.html">Inscription</a>
                </div>
                <div class="navbar-nav" id="userMenu" style="display: none;">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user me-1"></i>
                            <span id="userName"></span>
                        </a>
                        <ul class="dropdown-menu" id="dashboardLinks">
                            <!-- Liens dynamiques selon le rôle -->
                        </ul>
                    </li>
                </div>
            </div>
        </div>
    </nav>

    <!-- Contenu Principal -->
    <div class="container mt-5 pt-4">
        <div id="hotelContent">
            <!-- Le contenu de l'hôtel sera chargé ici -->
        </div>

        <!-- Types de Chambres -->
        <section class="py-5">
            <div class="container">
                <h2 class="mb-4">Nos Types de Chambres</h2>
                <div id="roomTypes" class="row">
                    <!-- Les types de chambres seront chargés ici -->
                </div>
            </div>
        </section>

        <!-- Services -->
        <section class="py-5 bg-light">
            <div class="container">
                <h2 class="mb-4">Services & Équipements</h2>
                <div class="row" id="servicesList">
                    <!-- Les services seront chargés ici -->
                </div>
            </div>
        </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../js/auth.js"></script>
    <script src="../js/api.js"></script>
    <script src="../js/main.js"></script>
    <script>
        let currentHotel = null;
        let roomTypes = [
            {
                type: 'standard',
                label: 'Chambre Standard',
                price: 35000,
                surface: '25 m²',
                capacity: '2 personnes',
                bed: '1 lit double',
                description: 'Chambre confortable avec tout le nécessaire pour un séjour agréable.',
                features: ['WiFi gratuit', 'Climatisation', 'Salle de bain privée', 'TV écran plat']
            },
            {
                type: 'junior',
                label: 'Suite Junior',
                price: 55000,
                surface: '40 m²',
                capacity: '3 personnes',
                bed: '1 lit king-size',
                description: 'Suite spacieuse avec espace de détente supplémentaire.',
                features: ['WiFi gratuit', 'Climatisation', 'Salle de bain luxueuse', 'TV écran plat', 'Mini-bar', 'Coffee maker']
            },
            {
                type: 'executive',
                label: 'Suite Executive',
                price: 85000,
                surface: '55 m²',
                capacity: '4 personnes',
                bed: '1 lit king-size + canapé-lit',
                description: 'Suite de luxe avec espace de travail et de détente.',
                features: ['WiFi gratuit', 'Climatisation', 'Salle de bain marbre', 'TV écran plat 55"', 'Mini-bar', 'Coffee maker', 'Bureau', 'Vue privilégiée']
            },
            {
                type: 'presidentielle',
                label: 'Suite Présidentielle',
                price: 150000,
                surface: '120 m²',
                capacity: '4 personnes',
                bed: '2 chambres séparées',
                description: 'Suite prestigieuse avec espace de vie et chambres séparées.',
                features: ['WiFi gratuit', 'Climatisation', 'Salle de bain spa', 'TV écran plat 65"', 'Mini-bar premium', 'Machine à café', 'Bureau exécutif', 'Vue panoramique', 'Service de majordome']
            }
        ];

        // Fonction pour obtenir les services par hôtel
        function getHotelServices(hotelId) {
            const services = {
                1: ['WiFi gratuit', 'Piscine extérieure', 'Spa & bien-être', 'Room Service 24h', 'Restaurant gastronomique', 'Parking sécurisé'],
                2: ['WiFi gratuit', 'Piscine intérieure', 'Salle de sport', 'Room Service 24h', 'Business Center', 'Parking couvert'],
                3: ['WiFi gratuit', 'Plage privée', 'Piscine avec vue mer', 'Restaurant fruits de mer', 'Spa thalasso', 'Activités nautiques'],
                4: ['WiFi gratuit', 'Parking sécurisé', 'Business Center', 'Salle de conférence', 'Room Service', 'Service de navette']
            };
            return services[hotelId] || services[1];
        }

        // Afficher les détails de l'hôtel
        function displayHotelDetails(hotel) {
            const container = document.getElementById('hotelContent');
            
            container.innerHTML = `
                <div class="row">
                    <div class="col-12">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item"><a href="../index.html">Accueil</a></li>
                                <li class="breadcrumb-item"><a href="hotels.html">Hôtels</a></li>
                                <li class="breadcrumb-item active">${hotel.nom}</li>
                            </ol>
                        </nav>
                    </div>
                </div>

                <div class="row mb-5">
                    <div class="col-lg-8">
                        <div class="card">
                            <div id="hotelCarousel" class="carousel slide" data-bs-ride="carousel">
                                <div class="carousel-inner">
                                    <div class="carousel-item active">
                                        <img src="${getHotelImage(hotel.id)}" class="d-block w-100" alt="${hotel.nom}" style="height: 400px; object-fit: cover;">
                                    </div>
                                    <div class="carousel-item">
                                        <img src="${Utils.generateRoomImage('executive')}" class="d-block w-100" alt="Chambre" style="height: 400px; object-fit: cover;">
                                    </div>
                                    <div class="carousel-item">
                                        <img src="https://images.unsplash.com/photo-1566073771259-6a8506099945?w=800&h=400&fit=crop" class="d-block w-100" alt="Piscine" style="height: 400px; object-fit: cover;">
                                    </div>
                                </div>
                                <button class="carousel-control-prev" type="button" data-bs-target="#hotelCarousel" data-bs-slide="prev">
                                    <span class="carousel-control-prev-icon"></span>
                                </button>
                                <button class="carousel-control-next" type="button" data-bs-target="#hotelCarousel" data-bs-slide="next">
                                    <span class="carousel-control-next-icon"></span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-body">
                                <h1 class="h3 card-title">${hotel.nom}</h1>
                                <div class="mb-3">
                                    ${generateStars(4)}
                                    <span class="text-muted ms-2">4.0/5 (128 avis)</span>
                                </div>
                                <p class="card-text">
                                    <i class="fas fa-map-marker-alt text-danger me-2"></i>${hotel.adresse || ''}, ${hotel.ville}
                                </p>
                                <p class="card-text">
                                    <i class="fas fa-phone text-primary me-2"></i>${Utils.formatPhoneNumber(hotel.telephone)}
                                </p>
                                <p class="card-text">
                                    <i class="fas fa-envelope text-info me-2"></i>${hotel.email || 'contact@hotel.tg'}
                                </p>
                                <div class="mt-4">
                                    <h5>À propos</h5>
                                    <p class="text-muted">${getHotelDescription(hotel.id)}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Afficher les types de chambres
        function displayRoomTypes(availableRooms) {
            const container = document.getElementById('roomTypes');
            container.innerHTML = '';

            roomTypes.forEach(roomType => {
                const availableCount = availableRooms.find(r => r.type_chambre === roomType.type)?.disponible || 0;
                const isAvailable = availableCount > 0;

                const roomCard = `
                    <div class="col-md-6 col-lg-3 mb-4">
                        <div class="card room-card h-100 ${!isAvailable ? 'opacity-75' : ''}">
                            <img src="${Utils.generateRoomImage(roomType.type)}" class="card-img-top" alt="${roomType.label}" style="height: 200px; object-fit: cover;">
                            <div class="card-body">
                                <h5 class="card-title">${roomType.label}</h5>
                                <p class="card-text text-muted small">
                                    <i class="fas fa-ruler-combined me-1"></i>${roomType.surface} 
                                    · <i class="fas fa-user me-1"></i>${roomType.capacity}
                                    · <i class="fas fa-bed me-1"></i>${roomType.bed}
                                </p>
                                <p class="card-text small">${roomType.description}</p>
                                <div class="mb-3">
                                    ${roomType.features.slice(0, 3).map(feature => 
                                        `<span class="badge bg-light text-dark me-1 mb-1 small">${feature}</span>`
                                    ).join('')}
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <span class="h5 text-primary mb-0">${API.formatPrice(roomType.price)}</span>
                                    <small class="text-muted">/nuit</small>
                                </div>
                                <div class="mt-3">
                                    ${isAvailable ? 
                                        `<a href="booking.html?hotelId=${currentHotel.id}&roomType=${roomType.type}" 
                                           class="btn btn-primary w-100 ${!Auth.isLoggedIn() ? 'disabled' : ''}"
                                           ${!Auth.isLoggedIn() ? 'title="Connectez-vous pour réserver"' : ''}>
                                            <i class="fas fa-calendar-plus me-2"></i>
                                            ${Auth.isLoggedIn() ? 'Réserver' : 'Se connecter'}
                                        </a>
                                        <small class="text-success d-block mt-1 text-center">
                                            <i class="fas fa-check me-1"></i>${availableCount} disponible(s)
                                        </small>` :
                                        `<button class="btn btn-secondary w-100" disabled>
                                            <i class="fas fa-times me-2"></i>Complet
                                        </button>`
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += roomCard;
            });
        }

        // Afficher les services
        function displayServices(services) {
            const container = document.getElementById('servicesList');
            container.innerHTML = '';

            services.forEach(service => {
                const serviceItem = `
                    <div class="col-md-6 col-lg-4 mb-3">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-check text-success me-3"></i>
                            <span>${service}</span>
                        </div>
                    </div>
                `;
                container.innerHTML += serviceItem;
            });
        }

        // Obtenir la description de l'hôtel
        function getHotelDescription(hotelId) {
            const descriptions = {
                1: "L'Hôtel Sarakawa, établissement emblématique de Lomé, allie luxe et tradition africaine. Profitez de nos installations premium et d'un service exceptionnel.",
                2: "Situé au cœur de Lomé, l'Hôtel du 2 Février offre un cadre moderne et professionnel idéal pour les voyageurs d'affaires et les touristes.",
                3: "Face à l'océan Atlantique, l'Hôtel Palm Beach vous propose une expérience balnéaire unique avec des vues panoramiques et un service de classe mondiale.",
                4: "L'Hôtel Concorde à Kara combine confort moderne et authenticité du nord Togo, parfait pour découvrir la richesse culturelle de la région."
            };
            return descriptions[hotelId] || "Établissement de qualité offrant un service exceptionnel et des installations modernes.";
        }

        function getHotelImage(hotelId) {
            const images = {
                1: 'https://images.unsplash.com/photo-1566073771259-6a8506099945?w=800&h=400&fit=crop',
                2: 'https://images.unsplash.com/photo-1520250497591-112f2f40a3f4?w=800&h=400&fit=crop',
                3: 'https://images.unsplash.com/photo-1551882547-ff40c63fe5fa?w=800&h=400&fit=crop',
                4: 'https://images.unsplash.com/photo-1618773928121-c32242e63f39?w=800&h=400&fit=crop'
            };
            return images[hotelId] || images[1];
        }

        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<i class="fas fa-star text-warning"></i>';
                } else {
                    stars += '<i class="far fa-star text-warning"></i>';
                }
            }
            return stars;
        }

        // Charger les données de l'hôtel
        async function loadHotelData() {
            const urlParams = new URLSearchParams(window.location.search);
            const hotelId = urlParams.get('id');

            if (!hotelId) {
                window.location.href = 'hotels.html';
                return;
            }

            try {
                const hotel = await API.getHotel(hotelId);
                currentHotel = hotel;
                
                displayHotelDetails(hotel);
                displayRoomTypes(hotel.chambres_disponibles || []);
                displayServices(getHotelServices(parseInt(hotelId)));
            } catch (error) {
                console.error('Erreur lors du chargement de l\'hôtel:', error);
                Utils.showError(document.getElementById('hotelContent'), 'Impossible de charger les détails de l\'hôtel.');
            }
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            Auth.updateNavigation();
            loadHotelData();
        });
    </script>
</body>
</html>